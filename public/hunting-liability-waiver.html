<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M77 AG Hunting Liability Waiver & Release</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f3f0;
            padding: 20px;
            padding-top: 80px;
            line-height: 1.6;
        }

        /* Navigation */
        .nav-wrapper {
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .navbar {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-family: 'Oswald', Arial, sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            text-decoration: none;
            letter-spacing: 2px;
        }

        .back-link {
            color: #2d5016;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link:hover {
            color: #d4af37;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .header {
            text-align: center;
            border-bottom: 3px solid #2d5016;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2d5016;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 14px;
        }
        
        .booking-info {
            background: #f8f6f3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid #d4af37;
        }
        
        .booking-info h3 {
            color: #2d5016;
            margin-bottom: 15px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .info-label {
            font-weight: bold;
            color: #666;
        }
        
        .critical-notice {
            background: #fff3cd;
            border: 3px solid #ff6b6b;
            padding: 25px;
            margin: 30px 0;
            border-radius: 8px;
        }
        
        .critical-notice h2 {
            color: #d32f2f;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .waiver-section {
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
        }
        
        .waiver-section h2 {
            color: #2d5016;
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        .waiver-section h3 {
            color: #8b6914;
            margin: 20px 0 10px 0;
            font-size: 18px;
        }
        
        .waiver-section p, .waiver-section li {
            margin: 10px 0;
            line-height: 1.8;
        }
        
        .waiver-section ul {
            margin-left: 25px;
        }
        
        .warning-box {
            background: #ffebee;
            border: 2px solid #c62828;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .warning-box h3 {
            color: #c62828;
            margin-bottom: 10px;
        }
        
        .signature-section {
            background: #e8f5e9;
            border: 3px solid #4caf50;
            padding: 30px;
            margin: 40px 0;
            border-radius: 10px;
        }
        
        .signature-section h2 {
            color: #2d5016;
            margin-bottom: 20px;
        }
        
        .signature-canvas-container {
            background: white;
            border: 2px solid #333;
            border-radius: 5px;
            margin: 20px 0;
            position: relative;
        }
        
        .signature-canvas {
            width: 100%;
            height: 200px;
            cursor: crosshair;
        }
        
        .signature-label {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #999;
            pointer-events: none;
            font-style: italic;
        }
        
        .signature-buttons {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-clear {
            background: #f44336;
            color: white;
        }
        
        .btn-clear:hover {
            background: #d32f2f;
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="date"],
        .form-group input[type="tel"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group input[type="text"]:focus,
        .form-group input[type="email"]:focus,
        .form-group input[type="date"]:focus,
        .form-group input[type="tel"]:focus {
            outline: none;
            border-color: #2d5016;
        }
        
        .checkbox-group {
            margin: 25px 0;
            padding: 20px;
            background: #fff9f0;
            border: 2px solid #d4af37;
            border-radius: 8px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            margin-top: 2px;
            flex-shrink: 0;
            cursor: pointer;
        }
        
        .checkbox-item label {
            cursor: pointer;
            user-select: none;
        }
        
        .submit-section {
            text-align: center;
            margin: 40px 0;
        }
        
        .btn-submit {
            background: #2d5016;
            color: white;
            padding: 18px 50px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(45,80,22,0.3);
        }
        
        .btn-submit:hover {
            background: #1f3710;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(45,80,22,0.4);
        }
        
        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .submit-section p {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        
        .error-message {
            background: #ffebee;
            border: 2px solid #f44336;
            color: #c62828;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            text-align: center;
        }
        
        .success-message {
            background: #e8f5e9;
            border: 3px solid #4caf50;
            color: #2d5016;
            padding: 40px;
            border-radius: 10px;
            margin: 30px 0;
            display: none;
            text-align: center;
        }
        
        .success-message h2 {
            color: #2d5016;
            margin-bottom: 20px;
        }
        
        .success-message p {
            font-size: 18px;
            margin: 15px 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                padding: 20px;
            }
            .btn, .signature-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="nav-wrapper">
        <nav class="navbar">
            <a href="/" class="logo">M77 AG</a>
            <a href="/hunting" class="back-link">Back to Hunting</a>
        </nav>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>M77 AG Hunting Liability Waiver & Release</h1>
            <p>Four Generations of Agricultural Excellence Since the Late 1800s</p>
            <p>Northeast Colorado</p>
        </div>

        <!-- Booking Information -->
        <div class="booking-info">
            <h3>Your Booking Information</h3>
            <div class="info-row">
                <span class="info-label">Booking Number:</span>
                <span id="bookingNumber">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">Property:</span>
                <span id="propertyName">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">Hunt Dates:</span>
                <span id="huntDates">Loading...</span>
            </div>
        </div>

        <!-- Critical Property Boundary Notice -->
        <div class="critical-notice">
            <h2>‚ö†Ô∏è CRITICAL: PROPERTY BOUNDARIES</h2>
            <p><strong>YOU MUST STAY WITHIN PROPERTY BOUNDARIES AT ALL TIMES.</strong></p>
            <p>Crossing property lines is:</p>
            <ul style="margin: 15px 0 15px 30px;">
                <li>A violation of Colorado hunting laws</li>
                <li>Trespassing on neighboring properties</li>
                <li>Grounds for immediate termination of your hunt with no refund</li>
                <li>Subject to criminal prosecution</li>
            </ul>
            <p><strong>Property maps will be provided AFTER you complete this waiver.</strong></p>
        </div>

        <!-- Downed Game Protocol -->
        <div class="warning-box">
            <h3>ü¶å DOWNED GAME PROTOCOL</h3>
            <p><strong>IF GAME CROSSES PROPERTY LINES:</strong></p>
            <p>You MUST immediately call Kyle McConnell at <strong>970-571-1015</strong> before pursuing or retrieving any downed game that has crossed onto neighboring property.</p>
            <p>Failure to follow this protocol may result in trespassing charges and termination of hunting privileges.</p>
        </div>

        <!-- Waiver Content -->
        <div class="waiver-section">
            <h2>LIABILITY WAIVER AND RELEASE OF CLAIMS</h2>
            
            <p><strong>READ CAREFULLY BEFORE SIGNING</strong></p>
            
            <p>This is a legally binding agreement. By signing this document, you are waiving certain legal rights, including the right to sue. Please read carefully and seek legal advice if you have questions.</p>

            <h3>1. ACKNOWLEDGMENT OF RISKS</h3>
            <p>I understand and acknowledge that hunting and outdoor recreational activities on agricultural land involve inherent and significant risks, including but not limited to:</p>
            <ul>
                <li>Risks from firearms, including accidental discharge, ricochets, and other firearm-related injuries</li>
                <li>Risks from wildlife, including aggressive animals, disease-carrying animals, and unpredictable wildlife behavior</li>
                <li>Environmental hazards including extreme weather, terrain obstacles, hidden holes, uneven ground, and natural obstacles</li>
                <li>Agricultural hazards including farm equipment, irrigation systems, livestock, and agricultural structures</li>
                <li>Medical emergencies in remote locations with limited access to emergency services</li>
                <li>Personal injury or death from any of the above risks</li>
            </ul>

            <h3>2. ASSUMPTION OF RISK</h3>
            <p>I voluntarily assume all risks associated with hunting and outdoor activities on M77 AG properties, whether those risks are known or unknown, anticipated or unanticipated. I understand that no amount of care, caution, instruction, or expertise can eliminate these risks.</p>

            <h3>3. RELEASE OF LIABILITY</h3>
            <p>In consideration of being permitted to hunt on M77 AG properties, I hereby RELEASE, WAIVE, DISCHARGE, and COVENANT NOT TO SUE the following parties (collectively "Released Parties"):</p>
            <ul>
                <li>M77 AG, ToGo AG, and any affiliated business entities</li>
                <li>Kyle McConnell, Brandi McConnell, and all family members</li>
                <li>All landowners, property managers, and employees</li>
                <li>All predecessors, successors, assigns, and affiliates</li>
            </ul>
            <p>From any and all liability, claims, demands, actions, and causes of action whatsoever arising out of or related to any loss, damage, or injury, including death, that may be sustained by me while participating in hunting activities or while on M77 AG properties.</p>

            <h3>4. INDEMNIFICATION</h3>
            <p>I agree to INDEMNIFY and HOLD HARMLESS the Released Parties from any loss, liability, damage, or costs, including attorney fees, that may arise due to my participation in hunting activities on M77 AG properties, whether caused by negligence of the Released Parties or otherwise.</p>

            <h3>5. PROPERTY BOUNDARIES AND LEGAL COMPLIANCE</h3>
            <p>I acknowledge and agree that:</p>
            <ul>
                <li>I am solely responsible for knowing and staying within property boundaries</li>
                <li>Property maps are provided as a courtesy but may contain errors</li>
                <li>I will verify boundaries using GPS, posted signs, and landmarks</li>
                <li>Crossing property lines constitutes trespassing and may result in criminal charges</li>
                <li>I must possess all required Colorado hunting licenses and stamps</li>
                <li>I will comply with all Colorado hunting regulations and seasons</li>
                <li>I will follow all M77 AG property rules and guidelines</li>
            </ul>

            <h3>6. DOWNED GAME RETRIEVAL</h3>
            <p>I understand that if wounded or downed game crosses property lines, I MUST:</p>
            <ul>
                <li>Immediately cease pursuit</li>
                <li>Contact Kyle McConnell at 970-571-1015 before proceeding</li>
                <li>Wait for authorization before entering neighboring property</li>
                <li>Follow all directions provided by property management</li>
            </ul>
            <p>I understand that unauthorized pursuit onto neighboring property will result in immediate termination of my hunting privileges with no refund and may result in criminal trespassing charges.</p>

            <h3>7. FIREARMS AND SAFETY</h3>
            <p>I certify that:</p>
            <ul>
                <li>I am legally permitted to possess and use firearms</li>
                <li>I am experienced in safe firearm handling</li>
                <li>I will follow all firearm safety rules at all times</li>
                <li>I will properly identify my target and what is beyond it before shooting</li>
                <li>I accept sole responsibility for any discharge of my firearm</li>
            </ul>

            <h3>8. MEDICAL TREATMENT</h3>
            <p>I authorize M77 AG representatives to obtain emergency medical treatment for me if necessary. I agree to assume all costs of such treatment and release the Released Parties from any liability related to medical treatment decisions or transportation.</p>

            <h3>9. LEGAL PROVISIONS</h3>
            <p>I understand that:</p>
            <ul>
                <li>This agreement is governed by Colorado law</li>
                <li>This waiver is binding upon my heirs, next of kin, executors, and administrators</li>
                <li>If any provision is found invalid, the remaining provisions remain in full effect</li>
                <li>This is the entire agreement and supersedes all prior agreements</li>
            </ul>

            <h3>10. VOLUNTARY PARTICIPATION</h3>
            <p>I certify that I am at least 18 years old, legally competent, and signing this agreement voluntarily without any inducement or assurance. I have read this waiver, fully understand its contents, and understand that I am giving up substantial legal rights including the right to sue.</p>
        </div>

        <!-- Signature Section -->
        <div class="signature-section">
            <h2>Electronic Signature & Acknowledgment</h2>
            
            <div class="form-group">
                <label for="participantName">Full Legal Name *</label>
                <input type="text" id="participantName" required placeholder="Enter your full legal name">
            </div>
            
            <div class="form-group">
                <label for="participantEmail">Email Address *</label>
                <input type="email" id="participantEmail" required placeholder="your.email@example.com">
            </div>
            
            <div class="form-group">
                <label for="participantPhone">Phone Number *</label>
                <input type="tel" id="participantPhone" required placeholder="(970) 555-1234">
            </div>

            <h3 style="margin: 30px 0 20px; color: #2d5016;">Vehicle Information (for property identification)</h3>
            <p style="font-size: 14px; color: #666; margin-bottom: 20px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107;">
                <strong>Why we need this:</strong> Vehicle information allows us to identify authorized hunters from a distance so we do not disrupt your hunt. If a vehicle does not match our records and there is no authorization card displayed in the dashboard, we will pursue trespassing charges.
            </p>

            <div class="form-group">
                <label for="vehicleMake">Vehicle Make *</label>
                <input type="text" id="vehicleMake" required placeholder="e.g., Ford, Chevrolet, Toyota">
            </div>

            <div class="form-group">
                <label for="vehicleModel">Vehicle Model *</label>
                <input type="text" id="vehicleModel" required placeholder="e.g., F-150, Silverado, Tacoma">
            </div>

            <div class="form-group">
                <label for="vehicleColor">Vehicle Color *</label>
                <input type="text" id="vehicleColor" required placeholder="e.g., White, Black, Red">
            </div>

            <div class="form-group">
                <label>Electronic Signature *</label>
                <p style="font-size: 14px; color: #666; margin-bottom: 10px;">Sign using your mouse or finger on touchscreen</p>
                <div class="signature-canvas-container">
                    <span class="signature-label">Sign here</span>
                    <canvas id="signatureCanvas" class="signature-canvas"></canvas>
                </div>
                <div class="signature-buttons">
                    <button type="button" class="btn btn-clear" onclick="clearSignature()">Clear Signature</button>
                </div>
            </div>
            
            <div class="form-group">
                <label for="signatureDate">Date *</label>
                <input type="date" id="signatureDate" required>
            </div>

            <!-- Required Acknowledgments -->
            <div class="checkbox-group">
                <h3 style="margin-bottom: 20px; color: #2d5016;">Required Acknowledgments</h3>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check1" required>
                    <label for="check1">I have read and understand this entire waiver and agreement</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check2" required>
                    <label for="check2">I understand that I am giving up important legal rights by signing this waiver</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check3" required>
                    <label for="check3">I am at least 18 years old and legally competent to sign this agreement</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check4" required>
                    <label for="check4">I am signing this waiver voluntarily and of my own free will</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check5" required>
                    <label for="check5">I acknowledge my responsibility to stay within property boundaries at all times</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check6" required>
                    <label for="check6">I understand the downed game protocol and will call Kyle McConnell (970-571-1015) if game crosses property lines</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check7" required>
                    <label for="check7">I accept full responsibility for my safety and well-being on farm property</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="check8" required>
                    <label for="check8">I agree to indemnify and hold harmless all Released Parties as described above</label>
                </div>
            </div>
        </div>

        <!-- Error/Success Messages -->
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message">
            <h2>‚úÖ Waiver Submitted Successfully!</h2>
            <p>Thank you for completing the liability waiver.</p>
            <p><strong>You will now be redirected to view your property maps and hunting information.</strong></p>
        </div>

        <!-- Submit Section -->
        <div class="submit-section">
            <button type="button" id="submitButton" class="btn-submit" onclick="submitWaiver()">
                SUBMIT WAIVER & VIEW PROPERTY MAPS
            </button>
            <p>By clicking submit, I certify that all information is true and accurate</p>
        </div>
    </div>

    <script>
        // Signature canvas setup
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let hasSignature = false;

        // Set canvas size
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = 200;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Mouse events
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch events
        canvas.addEventListener('touchstart', handleTouch);
        canvas.addEventListener('touchmove', handleTouch);
        canvas.addEventListener('touchend', stopDrawing);

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            hasSignature = true;
            document.querySelector('.signature-label').style.display = 'none';
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
            document.querySelector('.signature-label').style.display = 'block';
        }

        // Set today's date as default
        document.getElementById('signatureDate').valueAsDate = new Date();

        // Load booking information from URL parameters
        function loadBookingInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            const bookingId = urlParams.get('bookingId');
            
            if (bookingId) {
                // Fetch booking details from API
                fetch(`/api/bookings/${bookingId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && data.booking) {
                            const booking = data.booking;
                            document.getElementById('bookingNumber').textContent = bookingId.slice(-8).toUpperCase();
                            document.getElementById('propertyName').textContent = booking.parcel === 'heritage-farm' ? 'M77 AG Heritage Farm' : 'Prairie Peace';
                            document.getElementById('huntDates').textContent = `${new Date(booking.checkinDate).toLocaleDateString()} - ${new Date(booking.checkoutDate).toLocaleDateString()}`;
                            
                            // Pre-fill form if customer info matches
                            document.getElementById('participantName').value = booking.customerName || '';
                            document.getElementById('participantEmail').value = booking.email || '';
                            document.getElementById('participantPhone').value = booking.phone || '';
                        }
                    })
                    .catch(error => {
                        console.error('Error loading booking:', error);
                        document.getElementById('bookingNumber').textContent = bookingId.slice(-8).toUpperCase();
                    });
            }
        }
        loadBookingInfo();

        // Submit waiver
        async function submitWaiver() {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            // Validation
            const name = document.getElementById('participantName').value.trim();
            const email = document.getElementById('participantEmail').value.trim();
            const phone = document.getElementById('participantPhone').value.trim();
            const vehicleMake = document.getElementById('vehicleMake').value.trim();
            const vehicleModel = document.getElementById('vehicleModel').value.trim();
            const vehicleColor = document.getElementById('vehicleColor').value.trim();
            const date = document.getElementById('signatureDate').value;

            if (!name || !email || !phone || !vehicleMake || !vehicleModel || !vehicleColor || !date) {
                errorDiv.textContent = 'Please fill in all required fields including vehicle information.';
                errorDiv.style.display = 'block';
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            if (!hasSignature) {
                errorDiv.textContent = 'Please sign in the signature box.';
                errorDiv.style.display = 'block';
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            // Check all checkboxes
            const checkboxes = ['check1', 'check2', 'check3', 'check4', 'check5', 'check6', 'check7', 'check8'];
            for (const id of checkboxes) {
                if (!document.getElementById(id).checked) {
                    errorDiv.textContent = 'Please check all required acknowledgment boxes.';
                    errorDiv.style.display = 'block';
                    errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }
            }

            // Get signature as image
            const signatureData = canvas.toDataURL();

            // Get bookingId from URL
            const urlParams = new URLSearchParams(window.location.search);
            const bookingId = urlParams.get('bookingId');

            // Prepare data
            const waiverData = {
                bookingId: bookingId,
                participantName: name,
                participantEmail: email,
                participantPhone: phone,
                vehicleMake: vehicleMake,
                vehicleModel: vehicleModel,
                vehicleColor: vehicleColor,
                signatureDate: date,
                signature: signatureData,
                timestamp: new Date().toISOString()
            };

            // Submit to server
            try {
                document.getElementById('submitButton').disabled = true;
                document.getElementById('submitButton').textContent = 'SUBMITTING...';

                const response = await fetch('/api/bookings/submit-waiver', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(waiverData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    successDiv.style.display = 'block';
                    successDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    document.querySelector('.container').style.opacity = '0.7';
                    
                    // Redirect to property page with maps after 3 seconds
                    setTimeout(() => {
                        const booking = result.booking;
                        const propertyPage = booking.parcel === 'heritage-farm' ? 'heritage-farm-map.html' : 'prairie-peace-map.html';
                        window.location.href = `/${propertyPage}?bookingId=${bookingId}`;
                    }, 3000);
                } else {
                    throw new Error(result.message || 'Submission failed');
                }
            } catch (error) {
                console.error('Waiver submission error:', error);
                errorDiv.textContent = 'An error occurred while submitting the waiver. Please try again or contact us at 970-571-1015.';
                errorDiv.style.display = 'block';
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                document.getElementById('submitButton').disabled = false;
                document.getElementById('submitButton').textContent = 'SUBMIT WAIVER & VIEW PROPERTY MAPS';
            }
        }
    </script>
</body>
</html>