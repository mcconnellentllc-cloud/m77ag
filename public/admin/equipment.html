<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Admin | M77 AG</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: #f5f3f0;
            color: #2c2c2c;
            min-height: 100vh;
        }

        .admin-header {
            background: #1a1a1a;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            color: #d4af37;
            text-decoration: none;
        }

        .admin-nav {
            display: flex;
            gap: 30px;
        }

        .admin-nav a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }

        .admin-nav a:hover, .admin-nav a.active {
            color: #d4af37;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        .page-title {
            font-family: 'Oswald', sans-serif;
            font-size: 36px;
            margin-bottom: 30px;
            color: #1a1a1a;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-label {
            font-size: 13px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Oswald', sans-serif;
            font-size: 32px;
            color: #1a1a1a;
        }

        .stat-value.green { color: #27ae60; }
        .stat-value.gold { color: #d4af37; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #1a1a1a;
        }

        .tab.active {
            color: #d4af37;
            border-bottom-color: #d4af37;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Offers Table */
        .offers-table {
            width: 100%;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .offers-table th,
        .offers-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .offers-table th {
            background: #f8f8f8;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
            font-weight: 600;
        }

        .offers-table tr:hover {
            background: #fafafa;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.accepted {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.declined {
            background: #f8d7da;
            color: #721c24;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-right: 5px;
        }

        .action-btn.contact {
            background: #d4af37;
            color: #1a1a1a;
        }

        .action-btn.decline {
            background: #e0e0e0;
            color: #666;
        }

        /* Equipment Cards */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
        }

        .equipment-admin-card {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .card-title {
            font-family: 'Oswald', sans-serif;
            font-size: 20px;
            color: #1a1a1a;
            margin-bottom: 5px;
        }

        .card-subtitle {
            font-size: 13px;
            color: #666;
        }

        .card-price {
            text-align: right;
        }

        .price-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
        }

        .price-value {
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            color: #27ae60;
        }

        .card-body {
            padding: 20px;
        }

        .section-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #999;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e0e0e0;
        }

        /* Marketplace Suggestions */
        .marketplace-list {
            list-style: none;
        }

        .marketplace-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .marketplace-item:last-child {
            border-bottom: none;
        }

        .marketplace-rank {
            width: 28px;
            height: 28px;
            background: #d4af37;
            color: #1a1a1a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .marketplace-rank.secondary {
            background: #e0e0e0;
            color: #666;
        }

        .marketplace-info {
            flex: 1;
        }

        .marketplace-name {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 2px;
        }

        .marketplace-reason {
            font-size: 12px;
            color: #666;
        }

        .marketplace-action {
            padding: 6px 14px;
            background: #f5f5f5;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }

        .marketplace-action:hover {
            background: #d4af37;
            color: #1a1a1a;
        }

        /* Links Section */
        .share-links {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .link-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .link-row:last-child {
            margin-bottom: 0;
        }

        .link-label {
            font-size: 12px;
            color: #666;
            width: 80px;
        }

        .link-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            font-family: monospace;
            background: #fff;
        }

        .copy-btn {
            padding: 8px 12px;
            background: #1a1a1a;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background: #333;
        }

        /* Market Research Panel */
        .research-panel {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 20px;
            border-radius: 6px;
            color: #fff;
            margin-top: 20px;
        }

        .research-title {
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            color: #d4af37;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .research-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .research-stat {
            text-align: center;
        }

        .research-stat-value {
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            color: #fff;
        }

        .research-stat-label {
            font-size: 11px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }

        .empty-state h3 {
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            margin-bottom: 10px;
            color: #666;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .equipment-grid {
                grid-template-columns: 1fr;
            }

            .admin-header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <a href="/admin/dashboard.html" class="admin-logo">M77 AG ADMIN</a>
        <nav class="admin-nav">
            <a href="/admin/dashboard.html">Dashboard</a>
            <a href="/admin/hunting-bookings.html">Hunting</a>
            <a href="/admin/equipment.html" class="active">Equipment Sales</a>
            <a href="/admin/equipment-manager.html">Equipment Manager</a>
            <a href="/admin/testimonials.html">Testimonials</a>
            <a href="/forsale.html">View Listings</a>
        </nav>
    </header>

    <div class="container">
        <h1 class="page-title">Equipment Sales Manager</h1>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Active Listings</div>
                <div class="stat-value" id="activeListings">1</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Pending Offers</div>
                <div class="stat-value gold" id="pendingOffers">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Offer Value</div>
                <div class="stat-value" id="totalOfferValue">$0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Accepted Sales</div>
                <div class="stat-value green" id="acceptedSales">0</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="offers">Offers Received</button>
            <button class="tab" data-tab="listings">Listings & Advertising</button>
        </div>

        <!-- Offers Tab -->
        <div class="tab-content active" id="offers-tab">
            <table class="offers-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Equipment</th>
                        <th>List Price</th>
                        <th>Offer</th>
                        <th>Difference</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="offersTableBody">
                    <!-- Offers will be populated here -->
                </tbody>
            </table>
            <div class="empty-state" id="noOffers" style="display: none;">
                <h3>No Offers Yet</h3>
                <p>When buyers submit offers on your equipment, they'll appear here.</p>
            </div>
        </div>

        <!-- Listings Tab -->
        <div class="tab-content" id="listings-tab">
            <div class="equipment-grid" id="equipmentGrid">
                <!-- Equipment cards will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Equipment data with marketplace research
        const equipment = [
            {
                id: 'fk-2450',
                title: 'Farm King 2450 Round Bale Carrier',
                subtitle: '2018 | Excellent Condition',
                category: 'Hay Equipment',
                buyNowPrice: 34500,
                floorPrice: 32700,
                status: 'active',
                marketplaces: [
                    { name: 'Big Iron Auctions', reason: 'Highest hay equipment traffic in Great Plains region', url: 'https://www.bigiron.com', rank: 1 },
                    { name: 'Purple Wave', reason: 'Strong bale carrier sales, Kansas-based buyers', url: 'https://www.purplewave.com', rank: 2 },
                    { name: 'Facebook Marketplace', reason: 'Local ranchers actively searching, no fees', url: 'https://www.facebook.com/marketplace', rank: 3 },
                    { name: 'Machinery Pete', reason: 'Good price discovery, auction data reference', url: 'https://www.machinerypete.com', rank: 4 },
                    { name: 'Tractor House', reason: 'Wide dealer network, Farm King brand presence', url: 'https://www.tractorhouse.com', rank: 5 }
                ],
                research: { avgSalePrice: '$36,800', priceRange: '$31,000 - $42,000', avgDaysToSell: '23 days', recentSales: '14 (90 days)' },
                listingUrl: '/forsale.html?item=fk-2450'
            },
            {
                id: 'schaben-90',
                title: 'Schaben 90\' 3-Point Sprayer Boom',
                subtitle: '~2003 | 5 Sections with Raven Control',
                category: 'Sprayer Equipment',
                buyNowPrice: 12500,
                floorPrice: 10700,
                status: 'active',
                marketplaces: [
                    { name: 'Facebook Marketplace', reason: 'Local farmers searching for spray equipment, no fees', url: 'https://www.facebook.com/marketplace', rank: 1 },
                    { name: 'Big Iron Auctions', reason: 'Good sprayer equipment traffic in ag region', url: 'https://www.bigiron.com', rank: 2 },
                    { name: 'Tractor House', reason: 'Wide dealer network, sprayer category', url: 'https://www.tractorhouse.com', rank: 3 }
                ],
                research: { avgSalePrice: '$14,500', priceRange: '$8,000 - $18,000', avgDaysToSell: '30 days', recentSales: '8 (90 days)' },
                listingUrl: '/forsale.html?item=schaben-90'
            },
            {
                id: 'drago-1230',
                title: '2012 Drago Series 1 12-Row Corn Head',
                subtitle: '30" spacing, New Holland adapter, Headsight',
                category: 'Harvest Equipment',
                buyNowPrice: 31000,
                floorPrice: 26000,
                status: 'active',
                marketplaces: [
                    { name: 'Big Iron Auctions', reason: 'Strong corn head market, Plains region buyers', url: 'https://www.bigiron.com', rank: 1 },
                    { name: 'Purple Wave', reason: 'Harvest equipment sells well here', url: 'https://www.purplewave.com', rank: 2 },
                    { name: 'Machinery Pete', reason: 'Good Drago price history data', url: 'https://www.machinerypete.com', rank: 3 },
                    { name: 'Facebook Marketplace', reason: 'Local combine owners, NH community groups', url: 'https://www.facebook.com/marketplace', rank: 4 }
                ],
                research: { avgSalePrice: '$35,000', priceRange: '$28,000 - $45,000', avgDaysToSell: '35 days', recentSales: '6 (90 days)' },
                listingUrl: '/forsale.html?item=drago-1230'
            },
            {
                id: 'demco-sidequest',
                title: 'Demco SideQuest 1000 Gallon Saddle Tanks',
                subtitle: '2015 | Case Magnum mounts, hydraulic agitation',
                category: 'Sprayer Equipment',
                buyNowPrice: 11500,
                floorPrice: 10200,
                status: 'active',
                marketplaces: [
                    { name: 'Facebook Marketplace', reason: 'Case Magnum owners searching for tanks', url: 'https://www.facebook.com/marketplace', rank: 1 },
                    { name: 'Big Iron Auctions', reason: 'Sprayer equipment has good traffic', url: 'https://www.bigiron.com', rank: 2 },
                    { name: 'Tractor House', reason: 'Demco brand presence, dealer network', url: 'https://www.tractorhouse.com', rank: 3 }
                ],
                research: { avgSalePrice: '$13,500', priceRange: '$9,000 - $16,000', avgDaysToSell: '25 days', recentSales: '4 (90 days)' },
                listingUrl: '/forsale.html?item=demco-sidequest'
            },
            {
                id: 'danuser-auger',
                title: 'Danuser Post Hole Digger - Skid Steer',
                subtitle: '~2012 | Includes 14" and 8" auger bits',
                category: 'Attachments',
                buyNowPrice: 3000,
                floorPrice: 2777,
                status: 'active',
                marketplaces: [
                    { name: 'Facebook Marketplace', reason: 'Hot market for skid steer attachments', url: 'https://www.facebook.com/marketplace', rank: 1 },
                    { name: 'Craigslist', reason: 'Local buyers for smaller equipment', url: 'https://www.craigslist.org', rank: 2 },
                    { name: 'Big Iron Auctions', reason: 'Attachment category', url: 'https://www.bigiron.com', rank: 3 }
                ],
                research: { avgSalePrice: '$2,800', priceRange: '$1,800 - $3,500', avgDaysToSell: '14 days', recentSales: '12 (90 days)' },
                listingUrl: '/forsale.html?item=danuser-auger'
            },
            {
                id: 'stout-grapple',
                title: 'Stout 84" Grapple Bucket - Skid Steer',
                subtitle: '~2012 | Heavy duty, universal quick-attach',
                category: 'Attachments',
                buyNowPrice: 2500,
                floorPrice: 2277,
                status: 'active',
                marketplaces: [
                    { name: 'Facebook Marketplace', reason: 'Grapples sell fast on FB, local buyers', url: 'https://www.facebook.com/marketplace', rank: 1 },
                    { name: 'Craigslist', reason: 'Local contractors looking for attachments', url: 'https://www.craigslist.org', rank: 2 },
                    { name: 'Big Iron Auctions', reason: 'Attachment category', url: 'https://www.bigiron.com', rank: 3 }
                ],
                research: { avgSalePrice: '$2,800', priceRange: '$2,000 - $4,000', avgDaysToSell: '10 days', recentSales: '9 (90 days)' },
                listingUrl: '/forsale.html?item=stout-grapple'
            },
            {
                id: 'equipall-backhoe',
                title: 'EquipAll 860 Backhoe - Skid Steer',
                subtitle: '~2012 | Swing arm backhoe attachment',
                category: 'Attachments',
                buyNowPrice: 3700,
                floorPrice: 3377,
                status: 'active',
                marketplaces: [
                    { name: 'Facebook Marketplace', reason: 'Backhoe attachments in demand', url: 'https://www.facebook.com/marketplace', rank: 1 },
                    { name: 'Craigslist', reason: 'Local excavation contractors', url: 'https://www.craigslist.org', rank: 2 },
                    { name: 'Big Iron Auctions', reason: 'Skid steer attachment category', url: 'https://www.bigiron.com', rank: 3 }
                ],
                research: { avgSalePrice: '$4,000', priceRange: '$2,500 - $4,500', avgDaysToSell: '18 days', recentSales: '5 (90 days)' },
                listingUrl: '/forsale.html?item=equipall-backhoe'
            },
            {
                id: 'nh-concaves',
                title: 'New Holland Round Bar Concaves',
                subtitle: '2015 | Large frame CR series, good condition',
                category: 'Combine Parts',
                buyNowPrice: 750,
                floorPrice: 700,
                status: 'active',
                marketplaces: [
                    { name: 'Facebook Marketplace', reason: 'NH combine groups, parts seekers', url: 'https://www.facebook.com/marketplace', rank: 1 },
                    { name: 'eBay', reason: 'Good for combine parts, wide reach', url: 'https://www.ebay.com', rank: 2 },
                    { name: 'Craigslist', reason: 'Local NH combine owners', url: 'https://www.craigslist.org', rank: 3 }
                ],
                research: { avgSalePrice: '$800', priceRange: '$500 - $1,000', avgDaysToSell: '21 days', recentSales: '8 (90 days)' },
                listingUrl: '/forsale.html?item=nh-concaves'
            },
            {
                id: 'haybuster-bigbite',
                title: 'Haybuster Big Bite Tub Grinder',
                subtitle: 'H-1100 PTO driven, good screens, newer conveyor',
                category: 'Hay Equipment',
                buyNowPrice: 15700,
                floorPrice: 13200,
                status: 'active',
                marketplaces: [
                    { name: 'Big Iron Auctions', reason: 'Tub grinders sell well, cattle country buyers', url: 'https://www.bigiron.com', rank: 1 },
                    { name: 'Facebook Marketplace', reason: 'Ranchers looking for grinders', url: 'https://www.facebook.com/marketplace', rank: 2 },
                    { name: 'Purple Wave', reason: 'Good hay equipment category', url: 'https://www.purplewave.com', rank: 3 },
                    { name: 'Machinery Pete', reason: 'Haybuster price history', url: 'https://www.machinerypete.com', rank: 4 }
                ],
                research: { avgSalePrice: '$16,000', priceRange: '$7,000 - $28,000', avgDaysToSell: '30 days', recentSales: '6 (90 days)' },
                listingUrl: '/forsale.html?item=haybuster-bigbite'
            },
            {
                id: 'chevy-c70-feedtruck',
                title: '1982 Chevrolet C70 Feed Truck',
                subtitle: 'Gas motor, 5-speed, digital scale system',
                category: 'Feed Truck',
                buyNowPrice: 7500,
                floorPrice: 5500,
                status: 'active',
                marketplaces: [
                    { name: 'Facebook Marketplace', reason: 'Local ranchers searching for feed trucks', url: 'https://www.facebook.com/marketplace', rank: 1 },
                    { name: 'Craigslist', reason: 'Farm trucks sell well locally', url: 'https://www.craigslist.org', rank: 2 },
                    { name: 'Purple Wave', reason: 'Good ag truck auction market', url: 'https://www.purplewave.com', rank: 3 },
                    { name: 'Big Iron Auctions', reason: 'Feed mixer trucks category', url: 'https://www.bigiron.com', rank: 4 }
                ],
                research: { avgSalePrice: '$5,500', priceRange: '$3,800 - $8,500', avgDaysToSell: '21 days', recentSales: '8 (90 days)' },
                listingUrl: '/forsale.html?item=chevy-c70-feedtruck'
            }
        ];

        // DOM elements
        const offersTableBody = document.getElementById('offersTableBody');
        const noOffers = document.getElementById('noOffers');
        const equipmentGrid = document.getElementById('equipmentGrid');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadOffers();
            renderEquipmentCards();
            setupTabs();
            updateStats();
        });

        // Tab switching
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
                });
            });
        }

        // Store offers globally for actions
        let offersData = [];

        // Load offers from database API
        async function loadOffers() {
            try {
                const response = await fetch('/api/equipment/offers');
                const data = await response.json();

                if (!data.success || data.offers.length === 0) {
                    offersTableBody.innerHTML = '';
                    noOffers.style.display = 'block';
                    offersData = [];
                    return;
                }

                offersData = data.offers;
                noOffers.style.display = 'none';

                offersTableBody.innerHTML = data.offers.map((offer, idx) => {
                    const diff = offer.listPrice - (offer.finalPrice || offer.offerAmount);
                    const diffPercent = ((diff / offer.listPrice) * 100).toFixed(1);
                    const date = new Date(offer.createdAt).toLocaleDateString();
                    const finalAmount = offer.finalPrice || offer.offerAmount;

                    return `
                        <tr>
                            <td>${date}</td>
                            <td>
                                <strong>${offer.equipmentTitle}</strong><br>
                                <small style="color:#666">${offer.buyerName} - ${offer.buyerEmail}</small>
                            </td>
                            <td>$${offer.listPrice.toLocaleString()}</td>
                            <td><strong>$${finalAmount.toLocaleString()}</strong></td>
                            <td style="color: ${diff > 0 ? '#c0392b' : '#27ae60'}">
                                -$${diff.toLocaleString()} (${diffPercent}%)
                            </td>
                            <td><span class="status-badge ${offer.status}">${offer.status}</span></td>
                            <td>
                                <button class="action-btn contact" onclick="contactBuyer('${offer._id}')">Contact</button>
                                <button class="action-btn decline" onclick="removeOffer('${offer._id}')">Remove</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading offers:', error);
                // Fallback to localStorage
                loadOffersFromLocalStorage();
            }
        }

        // Fallback to localStorage if API fails
        function loadOffersFromLocalStorage() {
            const offers = JSON.parse(localStorage.getItem('m77ag_offers') || '[]');
            if (offers.length === 0) {
                offersTableBody.innerHTML = '';
                noOffers.style.display = 'block';
                return;
            }
            noOffers.style.display = 'none';
            offersTableBody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#999">Using local data - API unavailable</td></tr>';
        }

        // Update stats from API
        async function updateStats() {
            try {
                const response = await fetch('/api/equipment/stats');
                const data = await response.json();

                if (data.success) {
                    document.getElementById('activeListings').textContent = equipment.filter(e => e.status === 'active').length;
                    document.getElementById('pendingOffers').textContent = data.stats.pendingOffers;
                    document.getElementById('totalOfferValue').textContent = '$' + data.stats.totalSalesValue.toLocaleString();
                    document.getElementById('acceptedSales').textContent = data.stats.acceptedOffers;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Contact buyer - opens email
        function contactBuyer(offerId) {
            const offer = offersData.find(o => o._id === offerId);
            if (offer && offer.buyerEmail) {
                const subject = encodeURIComponent(`M77 AG - ${offer.equipmentTitle} Purchase`);
                const body = encodeURIComponent(`Hi ${offer.buyerName},\n\nThank you for your interest in the ${offer.equipmentTitle}.\n\nYour offer of $${(offer.finalPrice || offer.offerAmount).toLocaleString()} has been received.\n\nPlease let us know when you'd like to arrange pickup.\n\nBest regards,\nM77 AG\n970-774-3276`);
                window.open(`mailto:${offer.buyerEmail}?subject=${subject}&body=${body}`);
            } else {
                alert('No email address available for this buyer');
            }
        }

        // Remove offer via API
        async function removeOffer(offerId) {
            if (confirm('Remove this offer from the list?')) {
                try {
                    const response = await fetch(`/api/equipment/offers/${offerId}`, {
                        method: 'DELETE'
                    });
                    const data = await response.json();
                    if (data.success) {
                        loadOffers();
                        updateStats();
                    }
                } catch (error) {
                    console.error('Error removing offer:', error);
                    alert('Failed to remove offer');
                }
            }
        }

        // Render equipment cards with advertising suggestions
        function renderEquipmentCards() {
            equipmentGrid.innerHTML = equipment.map(item => `
                <div class="equipment-admin-card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">${item.title}</h3>
                            <p class="card-subtitle">${item.subtitle}</p>
                        </div>
                        <div class="card-price">
                            <div class="price-label">Buy Now</div>
                            <div class="price-value">$${item.buyNowPrice.toLocaleString()}</div>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="section-title">Where to Advertise</div>
                        <ul class="marketplace-list">
                            ${item.marketplaces.map(mp => `
                                <li class="marketplace-item">
                                    <span class="marketplace-rank ${mp.rank > 1 ? 'secondary' : ''}">${mp.rank}</span>
                                    <div class="marketplace-info">
                                        <div class="marketplace-name">${mp.name}</div>
                                        <div class="marketplace-reason">${mp.reason}</div>
                                    </div>
                                    <a href="${mp.url}" target="_blank" class="marketplace-action">Visit</a>
                                </li>
                            `).join('')}
                        </ul>

                        <div class="share-links">
                            <div class="link-row">
                                <span class="link-label">Direct Link</span>
                                <input type="text" class="link-input" value="https://m77ag.com${item.listingUrl}" readonly>
                                <button class="copy-btn" onclick="copyLink(this)">Copy</button>
                            </div>
                            <div class="link-row">
                                <span class="link-label">Facebook</span>
                                <input type="text" class="link-input" value="https://m77ag.com${item.listingUrl}&utm_source=facebook" readonly>
                                <button class="copy-btn" onclick="copyLink(this)">Copy</button>
                            </div>
                        </div>

                        <div class="research-panel">
                            <div class="research-title">Market Research</div>
                            <div class="research-grid">
                                <div class="research-stat">
                                    <div class="research-stat-value">${item.research.avgSalePrice}</div>
                                    <div class="research-stat-label">Avg Sale Price</div>
                                </div>
                                <div class="research-stat">
                                    <div class="research-stat-value">${item.research.avgDaysToSell}</div>
                                    <div class="research-stat-label">Avg Days to Sell</div>
                                </div>
                                <div class="research-stat">
                                    <div class="research-stat-value">${item.research.priceRange}</div>
                                    <div class="research-stat-label">Price Range</div>
                                </div>
                                <div class="research-stat">
                                    <div class="research-stat-value">${item.research.recentSales}</div>
                                    <div class="research-stat-label">Recent Sales</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Copy link
        function copyLink(btn) {
            const input = btn.previousElementSibling;
            input.select();
            document.execCommand('copy');
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 2000);
        }
    </script>
</body>
</html>
